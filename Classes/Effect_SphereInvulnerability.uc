//=============================================================================
// Effect_SphereInvulnerability.uc
// Copyright (C) 2020 0xC0ncord <concord@fuwafuwatime.moe>
//
// This program is free software; you can redistribute and/or modify
// it under the terms of the Open Unreal Mod License version 1.1.
//=============================================================================

class Effect_SphereInvulnerability extends RPGEffect;

var float ExpPerDamage;

var vector SphereLocation;
var float Radius;
var float EstimatedRunTime;

function bool ShouldDisplayEffect()
{
    return true;
}

state Activated
{
    function BeginState()
    {
        Super.BeginState();
        Instigator.Controller.bGodMode = True;
        SetTimer(0.1,true);
    }

    function Timer()
    {
        if(VSize(SphereLocation - Instigator.Location) > Radius || !class'Artifact_SphereInvulnerability'.static.IsActiveFor(EffectCauser.Pawn))
            Destroy();
    }

    function EndState()
    {
        Super.EndState();

        if(!class'Artifact_Invulnerability'.static.IsActiveFor(Instigator))
            Instigator.Controller.bGodMode = False;
        if(EffectOverlay != None)
            class'Sync_OverlayMaterial'.static.Sync(Instigator, None, 0, true);
    }
}

function Destroyed()
{
    Super.Destroyed();
    if(!class'Artifact_Invulnerability'.static.IsActiveFor(Instigator))
        Instigator.Controller.bGodMode = False;
    if(EffectOverlay != None)
        class'Sync_OverlayMaterial'.static.Sync(Instigator, None, 0, true);
}

defaultproperties
{
    EstimatedRunTime=8
    EffectOverlay=Shader'GlobeOverlay'
    EffectMessageClass=Class'EffectMessage_Invulnerability'
    bHarmful=False
    bAllowOnTeammates=True
    bAllowOnFlagCarriers=False
    bAllowOnGodMode=False
}
